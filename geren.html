<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>利率测算工具</title>
    <style>
        body {
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
            margin: 0;
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0f2f5;
        }

        .container {
            width: 33%;
            min-width: 600px;
            background: white;
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 2px 15px rgba(0,0,0,0.1);
            margin: 2rem 0;
        }

        .section {
            margin-bottom: 1.5rem;
            padding: 1rem;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
        }

        .form-group {
            margin-bottom: 1rem;
        }

        label {
            display: block;
            margin-bottom: 0.5rem;
            color: #374151;
            font-weight: 500;
        }

        input, select {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid #d1d5db;
            border-radius: 4px;
            box-sizing: border-box;
        }

        .result {
            margin-top: 2rem;
            padding: 1.5rem;
            background-color: #f8fafc;
            border-radius: 8px;
        }

        .row {
            display: flex;
            gap: 1rem;
        }

        .col {
            flex: 1;
        }
    </style>
</head>
<body>
    <div class="container">
        <h2>利率测算工具</h2>

        <!-- 配置模块 -->
        <div class="section">
            <h3>参数配置</h3>
            <div class="row">
                <div class="col">
                    <label>1年期LPR默认值(%)</label>
                    <input type="number" step="0.01" id="lpr1" value="3.0">
                </div>
                <div class="col">
                    <label>5年期LPR默认值(%)</label>
                    <input type="number" step="0.01" id="lpr5" value="3.5">
                </div>
            </div>
            <div class="row">
                <div class="col">
                    <label>抵押率默认值(%)</label>
                    <input type="number" step="1" id="mortgageRate" value="70">
                </div>
                <div class="col">
                    <label>累计优惠上限(BP)</label>
                    <input type="number" step="1" id="totalDiscountCap" value="100">
                </div>
            </div>
        </div>

        <!-- 基础信息 -->
        <div class="section">
            <h3>基础信息</h3>
            <div class="form-group">
                <label>客户类型</label>
                <select id="customerType">
                    <option value="个人">个人客户</option>
                    <option value="公司">公司客户（小微企业主）</option>
                </select>
            </div>
            <div class="form-group">
                <label>借款期限</label>
                <select id="loanTerm">
                    <option value="1">3年期以下（含3年）</option>
                    <option value="5">3年期以上</option>
                </select>
            </div>
            <div class="form-group">
                <label>借款额度(万元)</label>
                <input type="number" step="1" id="loanAmount" required>
            </div>
        </div>

        <!-- 客户分类 -->
        <div class="section" id="customerClassSection">
            <h3>客户分类</h3>
            <div class="form-group">
                <label>客户等级（个人）</label>
                <select id="customerLevel" style="display:none;">
                    <option value="一般客户">一般客户</option>
                    <option value="高端客户">高端客户</option>
                    <option value="其他优质客户">其他优质客户</option>
                </select>
            </div>
        </div>

        <!-- 担保方式 -->
        <div class="section">
            <h3>担保方式</h3>
            <div class="form-group">
                <label>担保类型</label>
                <select id="guaranteeType">
                    <option value="信用">信用</option>
                    <option value="抵押">足值抵押</option>
                    <option value="质押">足值质押</option>
                    <option value="保证+抵押">保证+抵押</option>
                    <option value="信用+抵押">信用+抵押</option>
                </select>
            </div>
            <div class="form-group" id="combinationGroup" style="display:none;">
                <label>抵押物评估额度(万元)</label>
                <input type="number" step="1" id="collateralValue">
            </div>
        </div>

        <!-- 优惠信息 -->
        <div class="section">
            <h3>利率优惠</h3>
            <div class="form-group">
                <label>社保卡数量(张)</label>
                <input type="number" step="1" id="socialCard" value="0">
            </div>
            <div class="form-group">
                <label>股金(万股)</label>
                <input type="number" step="1" id="stock" value="0">
            </div>
            <div class="form-group">
                <label>手机银行户数</label>
                <input type="number" step="1" id="mobileBank" value="0">
            </div>
            <div class="form-group">
                <label>是否开通聚合支付</label>
                <select id="聚合支付">
                    <option value="0">否</option>
                    <option value="20">是</option>
                </select>
            </div>
            <div class="form-group">
                <label>资金留存日均(万元)</label>
                <input type="number" step="1" id="deposit" value="0">
            </div>
        </div>

        <!-- 其他规则 -->
        <div class="section">
            <h3>其他规则</h3>
            <div class="form-group">
                <label>是否为潜力客户</label>
                <select id="potentialCustomer">
                    <option value="0">否</option>
                    <option value="50">是</option>
                </select>
            </div>
            <div class="form-group">
                <label>借款种类</label>
                <select id="loanType">
                    <option value="一般借款">一般借款</option>
                    <option value="原额度收回再贷">原额度原担保收回再贷</option>
                    <option value="续贷">续贷/借新还旧/债务重组</option>
                </select>
            </div>
            <div class="form-group" id="originalRateGroup" style="display:none;">
                <label>原执行利率(%)</label>
                <input type="number" step="0.01" id="originalRate">
            </div>
        </div>

        <button onclick="calculateRate()" style="width:100%; padding:0.8rem; background:#2563eb; color:white; border:none; border-radius:4px; cursor:pointer;">开始测算</button>

        <div class="result" id="resultArea">
            <h3>测算结果</h3>
            <p id="resultText"></p>
        </div>
    </div>

    <script>
        function getLPR() {
            const term = document.getElementById('loanTerm').value;
            return term === '1' ? parseFloat(document.getElementById('lpr1').value) : parseFloat(document.getElementById('lpr5').value);
        }

        function getBaseRate() {
            const customerType = document.getElementById('customerType').value;
            const amount = parseFloat(document.getElementById('loanAmount').value);
            const level = document.getElementById('customerLevel').value;
            const lpr = getLPR();

            if (customerType === '个人') {
                const isBelow50 = amount <= 50;
                switch (level) {
                    case '一般客户': return isBelow50 ? lpr + 3.5 : lpr + 4.0;
                    case '高端客户': return isBelow50 ? lpr + 0.5 : lpr + 1.0;
                    case '其他优质客户': return isBelow50 ? lpr + 1.0 : lpr + 1.5;
                }
            } else {
                const isBelow200 = amount <= 200;
                return isBelow200 ? lpr + 3.0 : lpr + 3.5;
            }
        }

        function calculateDiscount() {
            const socialCard = Math.min(parseInt(document.getElementById('socialCard').value) * 10, 50);
            const stock = Math.min(Math.floor(parseInt(document.getElementById('stock').value) / 10) * 10, 50);
            const mobileBank = Math.min(parseInt(document.getElementById('mobileBank').value) * 10, 40);
            const aggregation = parseInt(document.getElementById('聚合支付').value);
            const deposit = Math.min(parseInt(document.getElementById('deposit').value), 50);
            
            const channel = Math.min(mobileBank + aggregation, 40);
            const total = Math.min(socialCard + stock + channel + deposit, document.getElementById('totalDiscountCap').value);
            return total;
        }

        function calculateCombinationRate() {
            const x = parseFloat(document.getElementById('loanAmount').value);
            const y = parseFloat(document.getElementById('collateralValue').value);
            const rate = parseFloat(document.getElementById('mortgageRate').value) / 100;
            const a = x - (y * rate);
            const b = y * rate;
            
            const rateA = getBaseRate(a); // 假设a部分额度对应基础利率
            const rateB = getBaseRate(b); // 假设b部分额度对应基础利率
            return (a * rateA + b * rateB) / x;
        }

        function calculateRate() {
            // 基础LPR
            const lpr = getLPR();
            let baseRate = getBaseRate();
            
            // 组合担保处理
            const guaranteeType = document.getElementById('guaranteeType').value;
            if (guaranteeType === '保证+抵押' || guaranteeType === '信用+抵押') {
                baseRate = calculateCombinationRate();
            }

            // 足值抵押/质押处理
            if (guaranteeType === '抵押') baseRate -= 1.0;
            if (guaranteeType === '质押') baseRate = 3.5;

            // 优惠计算
            let discount = calculateDiscount();
            let finalRate = baseRate - (discount / 100);

            // 潜力客户加浮点
            finalRate += parseInt(document.getElementById('potentialCustomer').value) / 100;

            // 借款种类处理
            const loanType = document.getElementById('loanType').value;
            const originalRate = parseFloat(document.getElementById('originalRate').value) || 0;
            if (loanType === '原额度收回再贷') {
                const ruleRate = finalRate;
                finalRate = Math.min(originalRate + 0.5, ruleRate);
            } else if (loanType === '续贷') {
                finalRate = originalRate - 1.0;
            }

            // 最低利率限制
            finalRate = Math.max(finalRate, lpr);

            // 结果展示
            const bp = Math.round((finalRate - lpr) * 100);
            document.getElementById('resultText').innerHTML = `测算结果：LPR${bp > 0 ? '+' : ''}${bp}BP，执行年利率${finalRate.toFixed(2)}%`;
        }

        // 动态显示隐藏字段
        document.getElementById('customerType').addEventListener('change', (e) => {
            const levelSelect = document.getElementById('customerLevel');
            levelSelect.style.display = e.target.value === '个人' ? 'block' : 'none';
        });

        document.getElementById('guaranteeType').addEventListener('change', (e) => {
            const group = document.getElementById('combinationGroup');
            group.style.display = e.target.value === '保证+抵押' || e.target.value === '信用+抵押' ? 'block' : 'none';
        });

        document.getElementById('loanType').addEventListener('change', (e) => {
            const group = document.getElementById('originalRateGroup');
            group.style.display = e.target.value !== '一般借款' ? 'block' : 'none';
        });

        // 初始化显示
        document.getElementById('customerLevel').style.display = 'block';
    </script>
</body>
</html>    